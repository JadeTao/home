<!DOCTYPE html>
<html lang="en">
<head>

  
  <meta charset="utf-8">
  <title>&lt;译&gt; 英雄项目的 NativeScript 迁移 - Jader</title>
  <meta name="description" content="&lt;译&gt; 英雄项目的 NativeScript 迁移">
  <meta name="author" content="Jader Tao">

  
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://blog.jader.xyz/css/fonts.css">
  
  
  <link rel="stylesheet" href="https://unpkg.com/purecss@0.6.1/build/pure-min.css" integrity="sha384-CCTZv2q9I9m3UOxRLaJneXrrqKwUNOzZ6NGEUMwHtShDJ+nCoiXJCAgi05KfkLGY" crossorigin="anonymous">
  
  
    <link rel="stylesheet" href="https://unpkg.com/purecss@0.6.1/build/grids-responsive-min.css">
  
  <link rel="stylesheet" href="https://blog.jader.xyz/css/custom.css">

  
  
  <link rel="stylesheet" href="https://blog.jader.xyz/highlight/styles/github-gist.css">
  
  <script src="https://blog.jader.xyz/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <meta name="generator" content="Hugo 0.52" />
  
</head>
<body>

<div class="header pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
    <div class="pure-u-11-12 pure-u-md-5-8">
        <div class="desktop pure-menu pure-menu-horizontal nav-menu">
            
            <a href="https://blog.jader.xyz/" class="site-title pure-menu-heading">Jader</a>
            <ul class="pure-menu-list">
				
                <li class="pure-menu-item">
                    <a href="https://blog.jader.xyz/about/" class="pure-menu-link">About</a>
                </li>
            </ul>
        </div>
        <div class="mobile pure-menu nav-menu">
            <a href="/" class="pure-menu-heading" id="toggle-home">Jader</a>
            <a href="#" id="toggle-btn">&#9776;</a>
            <ul class="pure-menu-list" id="toggle-content" style="display:none;">
                
				
                <li class="pure-menu-item">
                    <a href="https://blog.jader.xyz/about" class="pure-menu-link">About</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>

<div class="pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
	<div class="pure-u-11-12 pure-u-md-5-8">
        <div class="post">

            <div class="post-title">
                <p class="footnote">
                    <time class="">2019-01-07</time>
		            
                    
                    

                    

                    
                </p>
                <h1>&lt;译&gt; 英雄项目的 NativeScript 迁移</h1>
            </div>

            <div class="post-content">
                

<blockquote>
<p>译者注: 本文是我为 <a href="https://github.com/sis0k0">Stanimira Vlaeva</a> from <code>NativeScript</code> 在 <a href="https://github.com/ngChina/ng-china-2018">ng china 2018</a> workshop 翻译的讲稿。<a href="https://github.com/ngChina/ng-china-2018/blob/master/From%20web%20to%20mobile%20with%20NativeScript%20and%20Angular/tutorial.md">原文</a>，<a href="https://github.com/ngChina/ng-china-2018/blob/master/From%20web%20to%20mobile%20with%20NativeScript%20and%20Angular/tutorial-zh.md">翻译</a>。</p>
</blockquote>

<h1> 英雄项目的 NativeScript 迁移之旅 </h1>

<blockquote>
<p>欢迎来到英雄项目 NativeScript 化迁移之旅的教程！你可以学到如何将你的 Angular web 项目扩展成能运行在 Android 和 iOS 上的应用。</p>
</blockquote>

<h1 id="准备">准备</h1>

<h2 id="nativescript-配置">NativeScript 配置</h2>

<p>你需要 NativeScript CLI 和一台 Android 或 iOS 物理设备来完成这个教程。</p>

<ol>
<li>运行下面的命令来安装  NativeScript CLI:</li>
</ol>

<pre><code class="language-bash">npm install -g nativescript@latest
</code></pre>

<ol>
<li>在等待 <code>npm install</code> 的过程中，你可以拿起手机安装两个配合运行的 app：</li>
</ol>

<table>
<thead>
<tr>
<th>app</th>
<th>Android</th>
<th>iOS</th>
</tr>
</thead>

<tbody>
<tr>
<td>NativeScript Preview</td>
<td><a href="https://play.google.com/store/apps/details?id=org.nativescript.preview">Google Play</a></td>
<td><a href="https://itunes.apple.com/us/app/nativescript-preview/id1264484702">App Store</a></td>
</tr>

<tr>
<td>NativeScript Playground</td>
<td><a href="https://play.google.com/store/apps/details?id=org.nativescript.play">Google Play</a></td>
<td><a href="https://itunes.apple.com/us/app/nativescript-playground/id1263543946">App Store</a></td>
</tr>
</tbody>
</table>

<h2 id="angular-配置">Angular 配置</h2>

<p>Angular CLI 提供了一些方便迁移和管理 Angular 项目的命令。 NativeScript 用自身的 <code>schematics</code> 集合扩展了 Angular CLI 的内置命令。通过执行下面的命令来安装 Angular CLI 和 NativeScript 扩展。</p>

<pre><code class="language-bash">npm install -g @angular/cli @nativescript/schematics
</code></pre>

<h2 id="应用">应用</h2>

<p>今天你将会对 <a href="https://angular.io/tutorial">Angular 官方文档教程</a> 中的英雄之旅项目进行迁移。</p>

<p>首先克隆这个项目的 web 完全版。</p>

<pre><code class="language-bash">git clone https://github.com/sebawita/tour-of-heroes/
cd tour-of-heroes
npm install
</code></pre>

<h1 id="将项目转换成代可以进行代码共享的结构">将项目转换成代可以进行代码共享的结构</h1>

<p>Angular CLI 提供的 <strong>ng add</strong> 命令让你可以为 Angular 项目添加不同的功能，比如 Angular material, ngRx, Firebase, Angular Apollo，当然也包括 NativeScript。
你可以使用 <strong>ng add</strong> 命令将 web 项目转换成供 Web 和 NativeScript 共享代码的项目结构。在项目中运行下面的命令即可：</p>

<pre><code class="language-bash">ng add @nativescript/schematics
</code></pre>

<h2 id="验证迁移">验证迁移</h2>

<p>确保转换顺利最简单的方式就是运行一下 web 和移动项目，亲眼看一下它们是否正常工作。
1. Web 端</p>

<p>运行下面的命令来启动 web 端应用:</p>

<pre><code class="language-bash">ng serve --open
</code></pre>

<p>当构建完成时，你的浏览器会自动打开一个新的标签页，页面中运行着之前的英雄之旅应用。</p>

<ol>
<li>移动端</li>
</ol>

<p>运行下面的命令来启动移动端应用:</p>

<pre><code>tns preview --bundle
</code></pre>

<p>此命令会在命令行终端输出一个二维码。打开你手机中的 <strong>NativeScript Playground</strong> 应用，用 <strong>Scan QR code</strong> 功能扫描命令行中的二维码。</p>

<p>扫描之后，<strong>NativeScript Preview</strong> 应用即会启动。一开始应用可能会白屏。先不要失望哦，等几秒（WiFi 信号差时可能慢至一分钟）你就会看到一个大按钮，告诉你 <strong>AUTO-GENERATED WORKS!</strong>。这样你就得到了你第一个 NativeScript Angular。爽不爽？
&gt; 提示：如果无法扫描二维码，可以试着更换命令行的颜色。</p>

<h2 id="进行第一次修改">进行第一次修改</h2>

<p>你不必在每次更新应用时都去扫描二维码。NativeScript CLI 会自动推送所有已保存的变更。</p>

<p>让我们来试一下。
1. 打开 <strong>src/app/auto-generated/auto-generated.component.tns.html</strong>。
2. 将 <code>text</code> 属性改为 <code>text=&quot;Hello World&quot;</code>。
3. 保存文件。</p>

<p>现在你应该会看到 app 中的大按钮写着 <strong>Hello World</strong> 💭🌍。</p>

<h2 id="导航">导航</h2>

<p>在迁移后的项目中你会发现联众不同的路由 <code>NgModule</code>：</p>

<ul>
<li><strong>app-routing.module.tns.ts</strong> - 一个 NativeScript 端路由 NgModule。</li>
</ul>

<blockquote>
<p>代码共享的项目使用命名约定来区分 web 端和移动端文件。NativeScript 特定的文件后缀为 <code>.tns</code>。 在 NativeScript 文档的 <a href="https://docs.nativescript.org/angular/code-sharing/code-splitting">代码分割</a> 章节你可以了解更多。</p>
</blockquote>

<p>打开文件 <strong>app-routing.module.tns.ts</strong>，你会注意到 NativeScript 引入了 <strong>NativeScriptRouterModule</strong>。这个模块封装了 Angular 提供的 <strong>RouterModule</strong>。NativeScript 扩展了 Angular 的默认路由，添加了一些移动设备的功能，比如屏幕之间的过渡动画。</p>

<p>你还会看到一个 <strong>routes</strong> 数组。它包含了一个指向 <strong>HomeComponent</strong> 的路由。在后面的教程中，我们会将 <strong>routes</strong> 移至一个普通的文件，以在 web 端和移动端的 <code>NgModule</code> 中共享。</p>

<h1> 迁移项目内容 </h1>

<p><strong>ng add @nativescript/schematics</strong> 这个命令将项目转换为代码共享的结构。然而它并没有转换应用的逻辑。关于自动生成的部分先讲到这里，是时候自己亲自动手写一写代码了！</p>

<p>接下来的几步：</p>

<ul>
<li>迁移 <strong>AppModule</strong></li>
<li>迁移其它的 <strong>modules</strong></li>
<li><em>(可选)</em> 统一 <strong>navigation</strong></li>
</ul>

<h1 id="迁移-appmodule">迁移 AppModule</h1>

<p>在这部分中，你将会编辑：
- <strong>app.module.ts</strong> - web 端的根模块;
- <strong>app.module.tns.ts</strong> - 移动端的根模块.</p>

<p>根模块 <code>NgModule</code>（通常叫做 <code>AppModule</code>）的迁移包括寻找它引入的 <code>NgModule</code> 的等价模块以及迁移它声明的组件。</p>

<h2 id="迁移-appmodule-的引入模块">迁移 AppModule 的引入模块</h2>

<p>让我们看一下 web 端 <code>NgModule</code> 的元信息中引入了哪些模块。</p>

<p><strong>app.module.ts</strong></p>

<pre><code class="language-js">imports: [
  BrowserModule,
  FormsModule,
  AppRoutingModule,
  HttpClientModule,

  HttpClientInMemoryWebApiModule.forRoot(
    InMemoryDataService, {dataEncapsulation: false}
  )
],
</code></pre>

<p>对 <strong>imports</strong> 部分的迁移工作指的是将 web 端文件 (<code>app.module.ts</code>) 改为移动端文件(<code>app.module.tns.ts</code>)。对每个引入的模块你都需要检查：</p>

<ul>
<li>如果这是 <strong>平台无关的引入</strong> - 意味着它在 web 和 {N}（注：{N} 指 NativeScript 环境）两种环境中均可工作 - 把它添加至 <strong>app.module.tns.ts</strong> 即可；</li>
<li>如果是平台相关的引入 - 我们需要找到 <strong>{N} 等价模块</strong> 并把等价模块添加至 <strong>app.module.tns.ts</strong>。</li>
</ul>

<h3 id="browsermodule"><strong>BrowserModule</strong></h3>

<p><strong>BrowserModule</strong> 是 <strong>web 特定</strong> 的模块。
它在 {N} 中的等价模块是 <strong>NativeScriptModule</strong>。 你的 <strong>app.module.tns.ts</strong> 已经引入了<strong>NativeScriptModule</strong>，这里不需再做额外工作。</p>

<h3 id="formsmodule"><strong>FormsModule</strong></h3>

<p><strong>FormsModule</strong> 也是 <strong>web 特定</strong> 的模块。
它在 {N} 中的等价模块是 <strong>NativeScriptFormsModule</strong>。你的 <strong>app.module.tns.ts</strong> 中有一条被注释掉的对它的引入，取消注释即可把它引入至<strong>NgModule imports</strong>。</p>

<h3 id="approutingmodule"><strong>AppRoutingModule</strong></h3>

<p>这个阶段我们有两个版本的 <strong>AppRoutingModule</strong>：</p>

<ul>
<li>Web - <strong>app-routing.module.ts</strong> - 包含 <strong>routes</strong> 来对你原来的 web 组件进行导航,</li>
<li>{N} - <strong>app-routing.module.tns.ts</strong> - 包含 <strong>routes</strong> 来导航至 <strong>HomeComponent</strong> 样例组件.</li>
</ul>

<p>稍后我们将详细探讨导航，现在我们先讨论如何将两种配置集合在一起。
不过，在迁移工作的这个阶段，还是将它们分开比较好。</p>

<p>你的 <strong>app.module.tns.ts</strong> 早已引入了 <strong>{N} AppRoutingModule</strong>，所以不需再做额外工作。</p>

<h3 id="httpclientmodule"><strong>HttpClientModule</strong></h3>

<p><strong>HttpClientModule</strong> 实际上不是 <strong>web 特定</strong>的。你也可以在移动应用中使用。但是，NativeScript 提供了相似的模块 - <code>NativeScriptHttpClientModule</code>。它扩展了默认的 Angular HTTP client，对移动端更加友好。我们推荐你优先使用 {N} module。</p>

<p>你的 <strong>app.module.tns.ts</strong> 已经有一条被注释了的对<strong>NativeScriptHttpClientModule</strong>的引入，取消注释即可把它引入至<strong>NgModule imports</strong>。</p>

<h3 id="httpclientinmemorywebapimodule-和-inmemorydataservice"><strong>HttpClientInMemoryWebApiModule</strong> 和 <strong>InMemoryDataService</strong></h3>

<p><strong>HttpClientInMemoryWebApiModule</strong> 和 <strong>InMemoryDataService</strong> 是平台无关的模块。把他们的引入从 <strong>app.module.ts</strong> 复制到 <strong>app.module.tns.ts</strong> 后我们就能顺利进行下去了。</p>

<h2 id="module-引入总结">Module 引入总结</h2>

<p>这是你 NativeScript 的 <strong>imports</strong> 应该的样子:</p>

<p><strong>app.module.tns.ts</strong></p>

<pre><code class="language-js">import { NativeScriptModule } from 'nativescript-angular/nativescript.module';
import { NativeScriptFormsModule } from 'nativescript-angular/forms';
import { NativeScriptHttpClientModule } from 'nativescript-angular/http-client';

import { AppRoutingModule } from './app-routing.module.tns';

import { HttpClientInMemoryWebApiModule } from 'angular-in-memory-web-api';
import { InMemoryDataService } from './in-memory-data.service';
...

@NgModule({
  ...
  imports: [
    NativeScriptModule,
    NativeScriptFormsModule,
    AppRoutingModule,
    NativeScriptHttpClientModule,

    HttpClientInMemoryWebApiModule.forRoot(
      InMemoryDataService, {dataEncapsulation: false}
    ),
  ],
  ...
})
export class AppModule { }
</code></pre>

<p>这是一张所有 <code>NgModule</code> imports 表:</p>

<table>
<thead>
<tr>
<th>Name</th>
<th>Same Module</th>
<th>{N} Name</th>
<th>import from</th>
</tr>
</thead>

<tbody>
<tr>
<td>BrowserModule</td>
<td>No</td>
<td>NativeScriptModule</td>
<td>&lsquo;nativescript-angular/nativescript.module&rsquo;</td>
</tr>

<tr>
<td>FormsModule</td>
<td>No</td>
<td>NativeScriptFormsModule</td>
<td>&lsquo;nativescript-angular/forms&rsquo;</td>
</tr>

<tr>
<td>AppRoutingModule</td>
<td>No</td>
<td>AppRoutingModule</td>
<td>&rsquo;./app-routing.module.tns&rsquo;</td>
</tr>

<tr>
<td>HttpClientModule</td>
<td>No</td>
<td>NativeScriptHttpClientModule</td>
<td>&lsquo;nativescript-angular/http-client&rsquo;</td>
</tr>

<tr>
<td>HttpClientInMemoryWebApiModule</td>
<td>Yes</td>
<td>&mdash;</td>
<td>&mdash;</td>
</tr>

<tr>
<td>InMemoryDataService</td>
<td>Yes</td>
<td>&mdash;</td>
<td>&mdash;</td>
</tr>
</tbody>
</table>

<h2 id="迁移-appmodule-组件">迁移 AppModule 组件</h2>

<p>下一步的任务是将 <strong>AppModule Components</strong> 迁移成代码共享的结构。</p>

<p>通常，组件的迁移由三个步骤组成：</p>

<ol>
<li>创建一个 <strong>{N}</strong> 版本的模板文件（例如 <strong>name.component.tns.html</strong>）

<ul>
<li>为它加上 <strong>{N} UI Code</strong></li>
</ul></li>
<li>（可选）创建一个 <strong>{N}</strong> 版本的样式文件（例如：<strong>name.component.tns.css</strong>）

<ul>
<li>为它加上 <strong>{N} UI Code</strong></li>
</ul></li>
<li>在 <strong>{N}</strong> AppModule (<code>app.module.tns.ts</code>)的 <strong>Declarations</strong> 中加入该组件<br />
（可选）将该组件添加至 {N} 导航。</li>
</ol>

<p>这步任务可以在 <a href="https://docs.nativescript.org/angular/code-sharing/migrating-a-web-project#schematic-migrate-component">migrate-component schematic</a> 的帮助下进行。它会自动完成前三步。通过下面的命令执行它：</p>

<pre><code class="language-bash">ng g migrate-component --name=component-name
</code></pre>

<h3 id="迁移-heroescomponent">迁移 HeroesComponent</h3>

<p>首先进行 <strong>HeroesComponent</strong> 的组件迁移：</p>

<pre><code class="language-bash">ng g migrate-component --name=heroes
</code></pre>

<p>这个命令通过如下方式更改你的项目：</p>

<ul>
<li>使用 <strong>heroes.component.html</strong> 中注释掉的 html 生成 <strong>heroes.component.tns.html</strong>；</li>
<li>生成 <strong>heroes.component.tns.css</strong> 空文件；</li>
<li>将 <strong>HeroesComponent</strong> 添加至 <strong>app.module.tns.ts</strong> 的 <strong>declarations</strong> 数组中。</li>
</ul>

<pre><code>src
└── app
    ├── heroes
    |   ├── heroes.component.html
    |   ├── heroes.component.tns.html &lt;= create
    |   └── heroes.component.ts
    |   └── heroes.component.tns.css  &lt;= create
    |   └── heroes.component.css
    ├── app.module.tns.ts             &lt;= update
    └── app.module.ts
</code></pre>

<h4 id="将组件加到移动端的导航中">将组件加到移动端的导航中</h4>

<p>你需要更新 NativeScript 的导航 <strong>routes</strong>，让它可以在应用启动时导航至新创建的 <strong>HeroesComponent</strong> 。</p>

<p><strong>app-routing.module.tns.ts</strong></p>

<pre><code class="language-js">import { HeroesComponent } from './heroes/heroes.component';

export const routes: Routes = [
  {path: '', redirectTo:'/heroes', pathMatch:'full'},
  {path: 'heroes', component: HeroesComponent},
];
</code></pre>

<p>你会看到屏幕中有一条简单的消息： *Heroes Component works*。</p>

<blockquote>
<p>如果你没有看到变化，试着重新构建应用。停止命令行的当前进程并再次执行预览命令：</p>

<pre><code>&gt; tns preview --bundle
&gt; ```

#### 更新模板

是时候创建你第一个移动端页面了！

&gt; NativeScript UI 组件是一个广泛的话题，今天的时间比较宝贵，我们不会深入探讨它。如果你想了解更多，可以看看这些资料：
&gt;  * [The interactive tutorial for {N} layouts](https://www.nslayouts.com/);
&gt;  * [UI Widgets](https://docs.nativescript.org/angular/ui/ng-ui-widgets/action-bar).

好了，让我们开始吧。html 模板看起来像这样：

**heroes.component.html**

```html
&lt;h2&gt;My Heroes&lt;/h2&gt;

&lt;div&gt;
  &lt;label&gt;Hero name:
    &lt;input #heroName /&gt;
  &lt;/label&gt;
  &lt;button (click)=&quot;add(heroName.value); heroName.value=''&quot;&gt;
    add
  &lt;/button&gt;
&lt;/div&gt;

&lt;ul class=&quot;heroes&quot;&gt;
  &lt;li *ngFor=&quot;let hero of heroes&quot;&gt;
    &lt;a routerLink=&quot;/detail/{{hero.id}}&quot;&gt;
      &lt;span class=&quot;badge&quot;&gt;{{hero.id}}&lt;/span&gt; {{hero.name}}
    &lt;/a&gt;
    &lt;button class=&quot;delete&quot; title=&quot;delete hero&quot;
      (click)=&quot;delete(hero)&quot;&gt;x&lt;/button&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</code></pre>
</blockquote>

<p>一开始，是:</p>

<p><strong>heroes.component.html</strong></p>

<pre><code class="language-html">&lt;h2&gt;My Heroes&lt;/h2&gt;
</code></pre>

<p>这显然是页面的标题。你可以用 <strong>ActionBar</strong> 来替换。</p>

<p><strong>heroes.component.tns.html</strong></p>

<pre><code class="language-html">&lt;ActionBar title=&quot;My Heroes&quot; class=&quot;action-bar&quot;&gt;
&lt;/ActionBar&gt;
</code></pre>

<p>接下来是一个包含着一个 label，一个 input 和一个 button 的 <code>div</code> 容器。</p>

<p><strong>heroes.component.html</strong></p>

<pre><code class="language-html">&lt;div&gt;
  &lt;label&gt;Hero name:
    &lt;input #heroName /&gt;
  &lt;/label&gt;
  &lt;button (click)=&quot;add(heroName.value); heroName.value=''&quot;&gt;
    add
  &lt;/button&gt;
&lt;/div&gt;
</code></pre>

<p>你需要进行如下替换：</p>

<ul>
<li>将 <code>&lt;div&gt;</code> 替换为 <code>&lt;GridLayout&gt;</code>，排成三列；</li>
<li>将 <code>&lt;label&gt;</code> 标签替换为 <code>&lt;Label&gt;</code> 标签（首字母大写），将<strong>Hero name:</strong>的值赋给标签的 <code>[text]</code> 属性；</li>
<li>将 <code>&lt;input&gt;</code> 替换为 <code>&lt;TextField&gt;</code>；</li>
<li>将 <code>&lt;button&gt;</code> 替换为 <code>&lt;Button&gt;</code> - 在这里你传入 <code>heroName.text</code>（而不是 <code>heroName.value</code>）；</li>
<li>将 <code>(click)</code> 事件属性替换为 <code>(tap)</code> 事件属性。</li>
</ul>

<p>像这样:</p>

<p><strong>heroes.component.tns.html</strong></p>

<pre><code class="language-html">&lt;GridLayout rows=&quot;auto&quot; columns=&quot;auto, *, auto&quot;&gt;
  &lt;Label text=&quot;Hero name:&quot; class=&quot;h2 m-l-5&quot;&gt;&lt;/Label&gt;
  &lt;TextField col=&quot;1&quot; hint=&quot;enter hero name...&quot; #heroName class=&quot;m-x-5&quot;&gt;&lt;/TextField&gt;
  &lt;Button col=&quot;2&quot; text=&quot;add&quot; (tap)=&quot;add(heroName.text); heroName.text=''&quot; class=&quot;btn btn-primary&quot;&gt;&lt;/Button&gt;
&lt;/GridLayout&gt;
</code></pre>

<p>下面是英雄列表:</p>

<pre><code class="language-html">&lt;ul class=&quot;heroes&quot;&gt;
  &lt;li *ngFor=&quot;let hero of heroes&quot;&gt;
    &lt;a routerLink=&quot;/detail/{{hero.id}}&quot;&gt;
      &lt;span class=&quot;badge&quot;&gt;{{hero.id}}&lt;/span&gt; {{hero.name}}
    &lt;/a&gt;
    &lt;button class=&quot;delete&quot; title=&quot;delete hero&quot;
      (click)=&quot;delete(hero)&quot;&gt;x&lt;/button&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</code></pre>

<p>你需要进行如下替换：</p>

<ul>
<li>将无序列表 <code>&lt;ul&gt;</code> 替换为 <code>&lt;ListView&gt;</code>；</li>
<li>将每一个 <code>&lt;li&gt;</code> 替换为 <code>&lt;ng-template&gt;</code>；</li>
<li>将导航链接 <code>&lt;a&gt;</code> 替换为 <code>GridLayout</code>。同时将 <code>routerLink</code> 指令换为 <code>nsRouterLink</code>；</li>
<li>将 <code>&lt;span&gt;</code> 替换为<code>&lt;Label&gt;</code>；</li>
<li>将 <code>&lt;button&gt;</code> 替换为 <code>&lt;Button&gt;</code>。</li>
</ul>

<p>像这样：</p>

<p><strong>heroes.component.tns.html</strong></p>

<pre><code class="language-html">&lt;ListView [items]=&quot;heroes&quot; class=&quot;list-group&quot; height=&quot;100%&quot;&gt;
  &lt;ng-template let-hero=&quot;item&quot;&gt;
    &lt;GridLayout columns=&quot;auto, *, auto&quot; nsRouterLink=&quot;/detail/{{hero.id}}&quot;&gt;
      &lt;Label col=&quot;0&quot; [text]=&quot;hero.id&quot; class=&quot;list-group-item&quot;&gt;&lt;/Label&gt;
      &lt;Label col=&quot;1&quot; [text]=&quot;hero.name&quot; class=&quot;list-group-item&quot;&gt;&lt;/Label&gt;
      &lt;Button col=&quot;2&quot; text=&quot;X&quot; (tap)=&quot;delete(hero)&quot; class=&quot;btn btn-primary&quot;&gt;&lt;/Button&gt;
    &lt;/GridLayout&gt;
  &lt;/ng-template&gt;
&lt;/ListView&gt;
</code></pre>

<p>最后，你需要用 <code>StackLayout</code> 将 <code>GridLayout</code> 和 <code>ListView</code> 包起来。</p>

<blockquote>
<p>请注意，包括 <strong>ActionBar</strong> 在内的 NativeScript 模板最多仅能包含一个组件。这就是你需要一个布局容器把其他组件囊括起来的原因。</p>
</blockquote>

<p>整个模板会像这样:</p>

<p><strong>heroes.component.tns.html</strong></p>

<pre><code class="language-js">&lt;ActionBar title=&quot;My Heroes&quot; class=&quot;action-bar&quot;&gt;
&lt;/ActionBar&gt;

&lt;StackLayout&gt;
  &lt;GridLayout rows=&quot;auto&quot; columns=&quot;auto, *, auto&quot;&gt;
    &lt;Label text=&quot;Hero name:&quot; class=&quot;h2 m-l-5&quot;&gt;&lt;/Label&gt;
    &lt;TextField col=&quot;1&quot; hint=&quot;enter hero name...&quot; #heroName class=&quot;m-x-5&quot;&gt;&lt;/TextField&gt;
    &lt;Button col=&quot;2&quot; text=&quot;add&quot; (tap)=&quot;add(heroName.text); heroName.text=''&quot; class=&quot;btn btn-primary&quot;&gt;&lt;/Button&gt;
  &lt;/GridLayout&gt;

  &lt;ListView [items]=&quot;heroes&quot; class=&quot;list-group&quot; height=&quot;100%&quot;&gt;
    &lt;ng-template let-hero=&quot;item&quot;&gt;
      &lt;GridLayout columns=&quot;auto, *, auto&quot; nsRouterLink=&quot;/detail/{{hero.id}}&quot;&gt;
        &lt;Label col=&quot;0&quot; [text]=&quot;hero.id&quot; class=&quot;list-group-item&quot;&gt;&lt;/Label&gt;
        &lt;Label col=&quot;1&quot; [text]=&quot;hero.name&quot; class=&quot;list-group-item&quot;&gt;&lt;/Label&gt;
        &lt;Button col=&quot;2&quot; text=&quot;X&quot; (tap)=&quot;delete(hero)&quot; class=&quot;btn btn-primary&quot;&gt;&lt;/Button&gt;
      &lt;/GridLayout&gt;
    &lt;/ng-template&gt;
  &lt;/ListView&gt;
&lt;/StackLayout&gt;
</code></pre>

<h4 id="更新样式">更新样式</h4>

<p>你可以用 CSS 来为 NativeScript 编写样式。为了让上面的组件更有吸引力，把下面的样式复制到 <strong>heroes.component.tns.css</strong>。</p>

<pre><code class="language-CSS">.container {
  background-color: #EFEFF4;
}

.search-container {
  padding: 15;
}

.search-container TextField {
  color: #757575;
  padding-left: 10;
  font-size: 20;
}

.search-container Button {
  background-color: #30CE91;
  color: white;
  font-size: 18;
  padding: 10 30;
  border-radius: 20;
}

ListView {
  background-color: transparent;
  separator-color: transparent;
}

.hero-container {
  background-color: white;
  border-radius: 10;
  margin: 10 15;
  padding: 15;

}
.circle {
  background-color: #C6D7FE;
  color: #2A48CD;
}

.hero-label {
  font-weight: bold;
  font-size: 18;
  margin-left: 10;
}

.delete-button {
  font-size: 24;
  font-weight: normal;
}
</code></pre>

<h2 id="迁移-herodetailcomponent">迁移 <code>HeroDetailComponent</code></h2>

<p>下一步你需要迁移 <strong>HeroDetailComponent</strong>。</p>

<p>步骤与前面相同.</p>

<ol>
<li><p>运行迁移命令.</p>

<pre><code class="language-bash">ng g migrate-component --name=hero-detail
</code></pre></li>

<li><p>在移动端导航配置中注册新的组件。</p>

<p><strong>app-routing.module.tns.ts</strong></p>

<pre><code class="language-bash">import { HeroDetailComponent } from './hero-detail/hero-detail.component';

export const routes: Routes = [
  {path: '', redirectTo:'/heroes', pathMatch:'full'},
  {path: 'heroes', component: HeroesComponent},
  {path: 'detail/:id', component: HeroDetailComponent},
];
</code></pre></li>

<li><p>更新 NativeScript 模板。</p></li>
</ol>

<p><strong>hero-detail.component.tns.html</strong></p>

<pre><code class="language-html">&lt;ActionBar title=&quot;{{hero?.name | uppercase}} Details&quot; icon=&quot;&quot;class=&quot;action-bar&quot;&gt;
&lt;/ActionBar&gt;

&lt;StackLayout *ngIf=&quot;hero&quot;&gt;
  &lt;Label text=&quot;ID: {{hero.id}}&quot; class=&quot;h1 text-center&quot;&gt;&lt;/Label&gt;
  &lt;TextField [(ngModel)]=&quot;hero.name&quot; hint=&quot;name&quot; class=&quot;input input-border&quot;&gt;&lt;/TextField&gt;

  &lt;Button text=&quot;Go Back&quot; (tap)=&quot;goBack()&quot; class=&quot;btn btn-primary&quot;&gt;&lt;/Button&gt;
  &lt;Button text=&quot;Save&quot; (tap)=&quot;save()&quot; class=&quot;btn btn-primary&quot;&gt;&lt;/Button&gt;
&lt;/StackLayout&gt;
</code></pre>

<ol>
<li>更新样式。</li>
</ol>

<p><strong>hero-detail.component.tns.css</strong></p>

<pre><code class="language-css">.container {
  background-color: #EDECF2;
}

.main-name {
  background-color: #2A48CD;
  font-size: 36;
  font-weight: bold;
  text-align: center;
  color: white;
  padding: 0 0 15 0;
}

.grid {
  margin: 30;
}

.circle {
  background-color: #C6D7FE;
  color: #2A48CD;
}

.name {
  font-size: 22;
  font-weight: bold;
  margin-left: 20;
}

.id-label {
  text-align: center;
}

.name-label {
  margin-left: 20;
}

.id-label, .name-label {
  margin-top: 10;
  color: #ABABAB;
}

.btn {
  background-color: #2A48CD;
  color: white;
  font-weight: bold;
  font-size: 18;
  padding: 15 0;
  border-radius: 25;
}
</code></pre>

<ol>
<li>试一下新页面</li>
</ol>

<p>运行 app 并导航到一个英雄页面再返回。重复几次以确定程序正常运行。</p>

<h2 id="迁移-dashboardcomponent-和-herosearchcomponent">迁移 DashboardComponent 和 HeroSearchComponent</h2>

<p><strong>DashboardComponent</strong> 使用了 <strong>HeroSearchComponent</strong>，这意味着你需要同时迁移这两个组件。</p>

<ol>
<li>为这两个组件运行迁移命令:</li>
</ol>

<pre><code class="language-bash">  ng g migrate-component --name=dashboard
  ng g migrate-component --name=hero-search
</code></pre>

<ol>
<li>更新导航</li>
</ol>

<p>在路由中为 <strong>DashboardComponent</strong> 添加一个新的路径。
但是，你不需要为 <strong>HeroSearchComponent</strong> 再添加路径，因为可以通过 <strong><app-hero-search></strong> 选择器直接使用它。</p>

<p><strong>app-routing.module.tns.ts</strong></p>

<pre><code class="language-bash">import { DashboardComponent } from './dashboard/dashboard.component';

export const routes: Routes = [
  {path: '', redirectTo:'/heroes', pathMatch:'full'},
  {path: 'heroes', component: HeroesComponent},
  {path: 'detail/:id', component: HeroDetailComponent},
  {path: 'dashboard', component: DashboardComponent},
];
</code></pre>

<ol>
<li>更新 the NativeScript 模板</li>
</ol>

<p><strong>dashboard.component.tns.html</strong></p>

<pre><code class="language-html">&lt;ActionBar title=&quot;Top Heroes&quot; icon=&quot;&quot;class=&quot;action-bar&quot;&gt;
&lt;/ActionBar&gt;

&lt;GridLayout rows=&quot;*, *&quot;&gt;
  &lt;ListView row=&quot;0&quot; [items]=&quot;heroes&quot; class=&quot;list-group&quot;&gt;
    &lt;ng-template let-hero=&quot;item&quot;&gt;
      &lt;Button [text]=&quot;hero.name&quot; nsRouterLink=&quot;/detail/{{hero.id}}&quot; class=&quot;btn btn-primary&quot;&gt;&lt;/Button&gt;
    &lt;/ng-template&gt;
  &lt;/ListView&gt;
  &lt;StackLayout row=&quot;1&quot;&gt;
    &lt;app-hero-search row=&quot;1&quot;&gt;&lt;/app-hero-search&gt;
  &lt;/StackLayout&gt;
&lt;/GridLayout&gt;
</code></pre>

<p><strong>hero-search.component.tns.css</strong></p>

<pre><code class="language-html">&lt;StackLayout&gt;
  &lt;Label text=&quot;Hero Search&quot; class=&quot;h1 text-center&quot;&gt;&lt;/Label&gt;

  &lt;TextField #heroName
    hint=&quot;enter hero-name&quot;
    autocorrect=&quot;false&quot;
    class=&quot;m-x-5&quot;
    (loaded)=&quot;heroName.text =''&quot;
    (textChange)=&quot;search($event.value)&quot;&gt;
  &lt;/TextField&gt;
  &lt;ListView [items]=&quot;heroes$ | async&quot; class=&quot;list-group&quot;&gt;
    &lt;ng-template let-hero=&quot;item&quot;&gt;
      &lt;Label [text]=&quot;hero.name&quot; nsRouterLink=&quot;/detail/{{hero.id}}&quot; class=&quot;list-group-item&quot;&gt;&lt;/Label&gt;
    &lt;/ng-template&gt;
  &lt;/ListView&gt;
&lt;/StackLayout&gt;
</code></pre>

<blockquote>
<p>有趣的是，<code>&lt;app-hero-search&gt;</code> 选择器在 web 端和移动端都可使用。因为 <strong>HeroSearchComponent</strong> 是平台无关的。</p>
</blockquote>

<ol>
<li>更新 NativeScript 样式:</li>
</ol>

<p><strong>dashboard.component.tns.css</strong></p>

<pre><code class="language-CSS">.header {
    font-size: 42;
    font-weight: bold;
    color: white;
    text-align: center;
    margin: 0 0 20 0;
}

FlexboxLayout {
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    align-content: flex-start;
    margin-top: 30;
}
.hero-container {
    width: 49%;
    border-width: 1;
    border-color: #395ad9;
}

.name {
    color: white;
    font-size: 20;
    text-align: center;
    margin: 10 0 20 0;
}

.circle {
    margin-top: 20;
}
</code></pre>

<p><strong>hero-search.component.tns.css</strong></p>

<pre><code class="language-CSS">.search-result li {
  border-bottom: 1px solid gray;
  border-left: 1px solid gray;
  border-right: 1px solid gray;
  width:195px;
  height: 16px;
  padding: 5px;
  background-color: white;
  cursor: pointer;
  list-style-type: none;
}

.search-result li:hover {
  background-color: #607D8B;
}

.search-result li a {
  color: #888;
  display: block;
  text-decoration: none;
}

.search-result li a:hover {
  color: white;
}
.search-result li a:active {
  color: white;
}
#search-box {
  width: 200px;
  height: 20px;
}


ul.search-result {
  margin-top: 0;
  padding-left: 0;
}
</code></pre>

<ol>
<li>试一下组件。</li>
</ol>

<p>此时，你的移动端应用还无法导航至 Dashboard。 导航到它最简单的方法就是修改默认 <strong>redirectTo</strong> 路径为<code>'/dashboard'</code>。像这样：</p>

<p><strong>app-routing.module.tns.ts</strong></p>

<pre><code class="language-js">export const routes: Routes = [
  {path: '', redirectTo:'/dashboard', pathMatch:'full'},
  {path: 'heroes', component: HeroesComponent},
  {path: 'detail/:id', component: HeroDetailComponent},
  {path: 'dashboard', component: DashboardComponent},
];
</code></pre>

<p>但一定要记得测试完改回去。</p>

<h2 id="sidedrawer-导航">SideDrawer 导航</h2>

<p>你现在还缺一个好方法实现在英雄页和 Dashboard 页之间导航。通常可以用 <strong>TabView</strong> 和 <strong>SideDrawer</strong>。</p>

<p>在本教程中，我们选择有一系列按钮的 <strong>SideDrawer</strong> 导航方式。</p>

<h3 id="添加-sidedrawer-插件">添加 SideDrawer 插件</h3>

<p>运行下面的命令以安装  <strong>NativeScript SideDrawer</strong></p>

<pre><code class="language-bash">tns plugin add nativescript-ui-sidedrawer
</code></pre>

<h3 id="更新-n-appmodule">更新 {N} AppModule</h3>

<p>然后你需要在 <strong>NativeScript AppModule</strong> 中引入 <strong>NativeScriptUISideDrawerModule</strong>。</p>

<p><strong>app.module.tns.ts</strong></p>

<pre><code class="language-js">import { NativeScriptUISideDrawerModule } from 'nativescript-ui-sidedrawer/angular';

@NgModule({
  imports: [
    ...
    NativeScriptUISideDrawerModule,
  ]
  ...
})
export class AppModule { }
</code></pre>

<h3 id="添加-sidedrawer">添加 SideDrawer</h3>

<p>在项目中添加 SideDrawer 非常容易。 就像 web 项目 <strong>app.component.html</strong> 中导航定义的那样，你可以将  SideDrawer 添加到 <strong>app.compoment.tns.html</strong>：</p>

<p><strong>app.component.tns.html</strong></p>

<pre><code class="language-html">&lt;RadSideDrawer&gt;
  &lt;GridLayout tkDrawerContent rows=&quot;*&quot; class=&quot;sidedrawer sidedrawer-left&quot;&gt;
    &lt;StackLayout class=&quot;sidedrawer-content&quot;&gt;
      &lt;Button text=&quot;heroes&quot; nsRouterLink=&quot;/heroes&quot; (tap)=&quot;closeDrawer()&quot; clearHistory=&quot;true&quot; class=&quot;btn btn-primary&quot;&gt;&lt;/Button&gt;
      &lt;Button text=&quot;dashboard&quot; nsRouterLink=&quot;/dashboard&quot; (tap)=&quot;closeDrawer()&quot; clearHistory=&quot;true&quot; class=&quot;btn btn-primary&quot;&gt;&lt;/Button&gt;
    &lt;/StackLayout&gt;
  &lt;/GridLayout&gt;

  &lt;page-router-outlet tkMainContent class=&quot;page page-content&quot;&gt;&lt;/page-router-outlet&gt;
&lt;/RadSideDrawer&gt;
</code></pre>

<p>注意，<code>&lt;GridLayout&gt;</code> 包含着 SideDrawer 的内容（你需要在这添加所有的导航链接）。但是页面的内容会在 <code>&lt;page-router-outlet&gt;</code> 处加载。</p>

<p>此外， 每个按钮都同时使用了 <code>nsRouterLink='/path'</code> 和 <code>clearHistory=&quot;true&quot;</code>。这是为了防止 iOS 在 ActionBar 上添加后退按钮，并防止 Android 在用户使用设备的返回功能时回退。</p>

<p>最后，每个按钮调用 <code>closeDrawer()</code> 函数，为了在应用导航后 SideDrawer 自己进行优雅的关闭，以提供良好的用户体院。</p>

<pre><code class="language-html">&lt;Button
	text=&quot;heroes&quot;
	nsRouterLink=&quot;/heroes&quot;
	clearHistory=&quot;true&quot;
	(tap)=&quot;closeDrawer()&quot;
	class=&quot;btn btn-primary&quot;&gt;
&lt;/Button&gt;
</code></pre>

<p>你需要在 <strong>app.component.tns.ts</strong> 中添加 <code>closeDrawer()</code> 函数，像这样：</p>

<pre><code class="language-js">import { Component } from '@angular/core';
import * as app from 'tns-core-modules/application';
import { RadSideDrawer } from 'nativescript-ui-sidedrawer';

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
})

export class AppComponent {
  closeDrawer() {
    const sideDrawer = &lt;RadSideDrawer&gt;app.getRootView();
    sideDrawer.closeDrawer();
  }
}
</code></pre>

<h3 id="测试-sidedrawer">测试 SideDrawer</h3>

<p>现在你可以在屏幕左侧滑动手指，SideDrawer 会出现。当你点击任何一个按钮时，SideDrawer 会关闭并导航至对应页面。</p>

<h1 id="共享导航">共享导航</h1>

<h2 id="分割路由">分割路由</h2>

<p>在这个阶段路由会被分割为两个不同的配置，分别应用在 web 端和移动端。</p>

<p>这是你启动一个 NativeScript 项目时，它会先展示 <strong>HomeComponent</strong> 的原因。</p>

<blockquote>
<p>在你将你的 web 组件迁移成代码共享结构时，路由分割通常是有用的。一旦迁移完成，你可以为双端选择一份单一的配置。</p>

<p>并且，如果你希望你的 web app 相比 mobile app 有不同的页面，你也可以使用两套不同的路由。比如是，你的 web app 有一个管理页面，但 mobile app 并不需要。这种情况下使用两套导航配置比较合理。</p>
</blockquote>

<p>这个阶段在你迁移每个页面组件时，你需要在 <strong>app-routing.module.tns.ts</strong> 的路由数组里添加对应的导航路径。</p>

<h2 id="共享路由">共享路由</h2>

<p>这个项目你可以简单地使用同一套 <strong>routes</strong> 配置，只需要将 <strong>routes</strong> 配置移到一个共享的文件。</p>

<h3 id="步骤-1-创建一个共享的路由文件">步骤 1 - 创建一个共享的路由文件。</h3>

<p>创建一个名为 <strong>app.routes.ts</strong> 的新文件 并将 <strong>app-routing.module.ts</strong> 中的 <strong>routes</strong> 数组复制过来。</p>

<p>确保<strong>导出</strong>了路由，确保引入了所有组件。</p>

<p><strong>app.routes.ts</strong></p>

<pre><code>import { Routes } from '@angular/router';
import { HeroesComponent } from './heroes/heroes.component';
import { DashboardComponent } from './dashboard/dashboard.component';
import { HeroDetailComponent } from './hero-detail/hero-detail.component';

export const routes: Routes = [
  {path: '', redirectTo:'/heroes', pathMatch:'full'},
  {path: 'heroes', component: HeroesComponent},
  {path: 'dashboard', component: DashboardComponent},
  {path: 'detail/:id', component: HeroDetailComponent},
];
</code></pre>

<h3 id="step-2-update-both-app-routing-files-with-the-shared-routes-property">Step 2 - Update both <strong>app-routing</strong> files with the shared <strong>routes</strong> property</h3>

<h3 id="步骤-2-使用共享的-routes-属性更新两个-app-routing-文件">步骤 2 - 使用共享的 <strong>routes</strong> 属性更新两个 <strong>app-routing</strong> 文件</h3>

<p>用从 <strong>&rsquo;./app.routes&rsquo;</strong> 引入的 <strong>routes</strong> 更新两个 <strong>app-routing</strong> 文件中 <strong>routes</strong> 的值。然后清理掉未使用的引入。</p>

<p><strong>app-routing.module.ts</strong></p>

<pre><code>import { NgModule } from '@angular/core';
import { RouterModule } from '@angular/router';
import { routes } from './app.routes';

@NgModule({
  imports: [
    RouterModule.forRoot(routes)
  ],
  exports: [
    RouterModule
  ]
})
export class AppRoutingModule { }
</code></pre>

<p><strong>app-routing.module.tns.ts</strong></p>

<pre><code>import { NgModule } from '@angular/core';
import { NativeScriptRouterModule } from 'nativescript-angular/router';
import { routes } from './app.routes';

@NgModule({
  imports: [
    NativeScriptRouterModule.forRoot(routes)
  ],
  exports: [
    NativeScriptRouterModule
  ]
})
export class AppRoutingModule { }
</code></pre>

<p>现在你有了一个双端共享的导航配置。</p>

<h1 id="圆满完成">圆满完成</h1>

<p>Congratulations! 你成功地将英雄之旅 app 转化为跨平台的项目，它可以运行在 web，Android 和 iOS 上。
如果你想阅读更多关于与 NativeScript 共享代码和迁移 web 应用的资料，可以看一下官方文档：</p>

<blockquote>
<p><a href="https://docs.nativescript.org/angular/code-sharing/migrating-a-web-project">Migrating a Web Project</a></p>

<p>Credits: This tutorial is created by Sebastian Witalec and partly edited by Stanimira Vlaeva.</p>
</blockquote>

            </div>
        </div>
	</div>
    <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>

<div class="footer pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
    <div class="pure-u-11-12 pure-u-md-5-8">
        <div class="footer-content">
		  <div class="pure-menu pure-menu-horizontal">
              <ul>
			      
                  <li class="pure-menu-heading" id="foot-name">Jader Tao:</li>
                  
				  
                  
          
                  
                  <li class="pure-menu-item">
                      <a href="https://github.com/JadeTao" class="pure-menu-link">GitHub</a>
                  </li>
                  
          
                  
          
                  
          
                  
          
              </ul>
              <a href="#" class="pure-menu-heading pull-right" id="gototop-btn">↑↑</a>
          </div>
		  
		</div>
	  </div>
      <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>


<script src="https://blog.jader.xyz/js/jquery.min.js" type="text/javascript"></script>
<script src="https://blog.jader.xyz/js/jquery.timeago.js" type="text/javascript"></script>
<script type="text/javascript">
  $(function(){
    $("time.timeago").timeago();
  })
  $("#toggle-btn").click(function(){
    $("#toggle-content").toggle();
    if($(this).html() === "☰") {
        $(this).html("X")
    } else {
        $(this).html("☰")
    }
  });
  $(window).resize(function(){
    if(window.innerWidth > 768) {
      $(".desktop").removeAttr("style");
    }
  });
</script>

</body>
</html>

